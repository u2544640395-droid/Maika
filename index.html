<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maika - Premium</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="style.css">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
</head>
<body>

    <div class="ambient-light">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

    <div class="screen active" id="splashScreen">
        <div class="m-auto text-center">
            <div class="w-24 h-24 bg-gradient-to-tr from-indigo-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-2xl shadow-indigo-500/30 mb-6 mx-auto animate-bounce">
                <i class="fas fa-bolt text-4xl text-white"></i>
            </div>
            <h1 class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">Maika</h1>
            <p class="text-indigo-300 mt-2 font-medium tracking-wide">Mobilité Premium</p>
        </div>
    </div>

    <div class="screen" id="loginScreen">
        <div class="p-8 flex flex-col h-full justify-center max-w-md mx-auto w-full">
            <div class="mb-10">
                <h1 class="text-3xl font-bold mb-2">Bienvenue</h1>
                <p class="text-gray-400">Entrez votre numéro pour commencer</p>
            </div>
            <div class="input-box rounded-2xl p-4 flex items-center gap-4 mb-6">
                <i class="fas fa-phone-alt text-gray-400"></i>
                <div class="h-6 w-px bg-gray-700"></div>
                <input type="tel" id="phoneInput" placeholder="34 00 000 00" class="bg-transparent outline-none w-full text-lg font-medium">
            </div>
            <button onclick="authLogin()" class="btn-gradient w-full py-4 rounded-2xl font-bold text-lg mb-6 relative overflow-hidden">
                <span class="relative z-10">Connexion</span>
            </button>
            <div onclick="toggleDriverMode()" class="text-center py-4 cursor-pointer opacity-70 hover:opacity-100 transition">
                <p class="text-xs uppercase tracking-widest font-semibold" id="driverModeText">Passer en mode Prestataire</p>
            </div>
        </div>
    </div>

    <div class="screen" id="homeScreen">
        <div class="p-6 pt-12">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <p class="text-gray-400 text-sm">Bonjour,</p>
                    <h2 class="text-2xl font-bold" id="userName">Voyageur</h2>
                </div>
                <div onclick="logout()" class="w-10 h-10 rounded-full glass flex items-center justify-center text-red-400 cursor-pointer"><i class="fas fa-power-off"></i></div>
            </div>
            <div onclick="openMapMode()" class="glass rounded-3xl p-6 mb-6 relative overflow-hidden group active:scale-95 transition-all duration-300 cursor-pointer">
                <div class="absolute inset-0 bg-gradient-to-r from-indigo-600/20 to-purple-600/20 opacity-0 group-hover:opacity-100 transition"></div>
                <div class="relative z-10 flex justify-between items-center">
                    <div>
                        <div class="w-12 h-12 rounded-2xl bg-indigo-500 flex items-center justify-center mb-4 shadow-lg shadow-indigo-500/30"><i class="fas fa-car-alt text-xl"></i></div>
                        <h3 class="text-xl font-bold mb-1">Commander</h3>
                        <p class="text-sm text-gray-400">Course immédiate</p>
                    </div>
                    <i class="fas fa-chevron-right text-gray-500"></i>
                </div>
            </div>
            <div class="glass rounded-3xl p-6 relative overflow-hidden opacity-75">
                <div class="relative z-10">
                    <div class="w-12 h-12 rounded-2xl bg-cyan-500/20 flex items-center justify-center mb-4 text-cyan-400"><i class="fas fa-map-marked-alt text-xl"></i></div>
                    <h3 class="text-xl font-bold mb-1">Location</h3>
                    <p class="text-sm text-gray-400">Province & Long trajet</p>
                </div>
            </div>
        </div>
    </div>

    <div class="screen" id="mapScreen">
        <div id="map-view"></div>
        
        <div class="absolute top-0 left-0 w-full p-4 pt-12 z-20 flex items-start gap-3 pointer-events-none">
            <button onclick="nav('homeScreen')" class="w-10 h-10 rounded-full glass-panel text-white flex items-center justify-center pointer-events-auto shadow-lg"><i class="fas fa-arrow-left"></i></button>
            <div class="glass-panel px-4 py-2 rounded-full flex items-center gap-2 shadow-lg max-w-[70%] pointer-events-auto">
                <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
                <p class="text-xs font-medium truncate" id="addressBadge">Localisation...</p>
            </div>
        </div>

        <div class="center-pin" id="mapPin">
            <div class="relative"><i class="fas fa-map-marker-alt text-5xl text-indigo-500 filter drop-shadow-xl"></i><div class="pin-shadow"></div></div>
        </div>

        <div class="bottom-sheet glass-panel rounded-t-3xl p-6 open" id="orderSheet">
            <div class="w-12 h-1 bg-gray-600 rounded-full mx-auto mb-6"></div>
            <div class="mb-6">
                <label class="text-xs text-gray-400 uppercase font-bold tracking-wider mb-2 block">Destination</label>
                <div class="input-box rounded-xl p-3 flex items-center gap-3">
                    <i class="fas fa-search text-indigo-400"></i>
                    <input type="text" id="destInput" placeholder="Où allez-vous ?" class="bg-transparent w-full outline-none font-medium" readonly>
                </div>
            </div>
            <button onclick="createRequest()" id="btnRequest" class="btn-gradient w-full py-4 rounded-xl font-bold shadow-lg">Trouver un véhicule</button>
        </div>

        <div class="bottom-sheet glass-panel rounded-t-3xl p-6" id="trackingSheet">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-xl font-bold text-white">Véhicule trouvé !</h2>
                    <p class="text-indigo-400 text-sm">Arrivée estimée : 4 min</p>
                </div>
                <div class="w-12 h-12 rounded-full bg-gray-700 border-2 border-indigo-500 overflow-hidden">
                    <img src="https://i.pravatar.cc/150?img=11" class="w-full h-full object-cover">
                </div>
            </div>
            <button onclick="cancelRide()" class="w-full py-3 rounded-xl glass text-red-400 font-medium">Annuler</button>
        </div>
    </div>

    <div class="screen" id="driverScreen">
        <div class="bg-gray-900 border-b border-gray-800 p-4 safe-top flex justify-between items-center">
            <div><span class="text-xs font-bold bg-green-500/20 text-green-400 px-2 py-1 rounded uppercase">En Ligne</span><h1 class="font-bold text-lg mt-1">Espace Prestataire</h1></div>
            <button onclick="refreshRequests()" class="w-10 h-10 glass rounded-full flex items-center justify-center"><i class="fas fa-sync-alt"></i></button>
        </div>
        <div id="requestList" class="p-4 space-y-3 overflow-y-auto flex-1"></div>
        <div class="bg-black/50 p-2 text-center"><p class="text-xs font-mono text-gray-500" id="gpsStatus">GPS: Standby</p></div>
    </div>

    <div id="toast" class="toast glass-panel px-6 py-4 rounded-full flex items-center gap-3 shadow-2xl border border-indigo-500/30">
        <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center"><i class="fas fa-bell text-white text-sm"></i></div>
        <span class="font-medium text-sm" id="toastMsg">Notification</span>
    </div>

    <script src="main.js"></script>
</body>
</html>
